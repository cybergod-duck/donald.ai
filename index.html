<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DON.AI | CYBERTRUMP</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #frame { width: 800px; height: 450px; border: 2px solid #0f0; position: relative; background: #000; box-shadow: 0 0 20px #0f0; }
        #visual { width: 100%; height: 100%; object-fit: cover; }
        
        #frame::after { 
            content: " "; position: absolute; top: 0; left: 0; bottom: 0; right: 0; 
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); 
            z-index: 50; background-size: 100% 2px, 3px 100%; 
            pointer-events: none;
        }
        
        #load-bar { position: absolute; top: 0; left: 0; width: 0%; height: 4px; background: #0f0; box-shadow: 0 0 10px #0f0; transition: width 0.3s; z-index: 100; }
        #terminal { width: 800px; margin-top: 15px; border: 1px solid #0f0; padding: 10px; background: #000; cursor: text; }
        input { background: transparent; border: none; color: #0f0; width: 95%; font-size: 1.2rem; outline: none; font-family: inherit; }
        
        .glitch { animation: g 0.15s infinite; filter: hue-rotate(90deg) contrast(2) brightness(1.2); }
                #title { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); text-align: center; z-index: 100; }
        #title h1 { font-size: 3rem; color: #00ffff; text-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff; margin: 0; font-weight: bold; }
        #title p { font-size: 1.2rem; color: #ffffff; margin: 5px 0 0 0; opacity: 0.9; }
        @keyframes g { 0% { transform: translate(2px, 1px); } 50% { transform: translate(-2px, -1px); } 100% { transform: translate(0); } }
    </style>
</head>
<body onclick="document.getElementById('cmd').focus()">
        <div id="title">
            <h1>Donald.AI</h1>
            <p>Have Trump give you a speech about anything you want</p>
        </div>
    <div id="frame">
        <div id="load-bar"></div>
            <video id="visual" src="/6.mp4" muted autoplay loop playsinline></video>    </div>
    <div id="terminal">
        <span>> </span><input type="text" id="cmd" placeholder="ASK TRUMP ANYTHING..." autocomplete="off">
    </div>

    <script>
        const input = document.getElementById('cmd');
        const visual = document.getElementById('visual');
        const bar = document.getElementById('load-bar');

        input.focus();

                // Add strobe glitch effect near end of idle video loop
        let strobeActive = false;
        visual.addEventListener('timeupdate', () => {
            if (visual.src.includes('/6.mp4') && visual.duration > 0) {
                const timeLeft = visual.duration - visual.currentTime;
                // Trigger strobe in the last 0.6 seconds
                if (timeLeft < 0.6 && timeLeft > 0 && !strobeActive) {
                    strobeActive = true;
                    // Create rapid strobe effect - 6 flashes
                    let count = 0;
                    const strobeInterval = setInterval(() => {
                        visual.style.opacity = count % 2 === 0 ? '0.3' : '1';
                        count++;
                        if (count >= 6) {
                            clearInterval(strobeInterval);
                            visual.style.opacity = '1';
                            strobeActive = false;
                        }
                    }, 50); // Flash every 50ms
                }
            }
        });

        input.onkeydown = async (e) => {
            if (e.key === 'Enter') {
                const prompt = input.value.trim();
                if (!prompt) return;

                input.value = "";
                input.style.opacity = "0.3"; 
                bar.style.width = "30%";
                visual.classList.add('glitch');

                // Play 0.mp4 heavy glitch starting sequence for 1 second
                visual.src = '/0.mp4';
                visual.style.filter = 'brightness(2) contrast(2.5) saturate(1.5)';
                await new Promise(resolve => setTimeout(resolve, 1000));
                visual.style.filter = '';

                try {
                    const res = await fetch('/api/generate', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt }) });
                    const blob = await res.blob();
                    const audio = new Audio(URL.createObjectURL(blob));

                    audio.onplay = () => {
                        bar.style.width = "0%";
                        visual.classList.remove('glitch');
                                    let glitchInterval;
                const shuffle = () => {
                    const randomVideo = Math.floor(Math.random() * 5) + 1;
                    visual.src = '/' + randomVideo + '.mp4';
                                        // Add white strobe/flash effect
                    const flashEffect = count % 3 === 0 ? 'brightness(2.5) saturate(0) contrast(2)' : '';
                    visual.style.filter = flashEffect;
                };
                
                // Start glitching effect - rapidly switch videos
                glitchInterval = setInterval(shuffle, 3000); // Change video every 150ms // Change video every 1.8s for natural talking effect // Switch videos every 3s to show different angles/distances
                shuffle(); // Start immediately
                
                audio.onended = () => {
                    clearInterval(glitchInterval); // Stop glitching
                    visual.src = "/6.mp4"; // Return to idle video        input.style.opacity = "1";
                            input.focus(); 
                                                input.style.opacity = "1";
                        };
                    };
                    audio.play();
                } catch (err) {
                    alert("CONNECTION ERROR");
                    visual.classList.remove('glitch');
                    input.style.opacity = "1";
                    bar.style.width = "0%";
                    input.focus();
                }
            }
        }
    </script>
</body>
</html>
